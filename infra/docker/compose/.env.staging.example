# ============================================
# Exam Prep Platform - Staging Environment Variables
# ============================================
# Copy this file to .env.staging and update with staging-specific values
# NEVER commit .env.staging files to version control
# IMPORTANT: Use DIFFERENT secrets from production

# ============================================
# Global Configuration
# ============================================
ENV=staging

# ============================================
# Domain Configuration
# ============================================
DOMAIN=example.com
# Staging domains (must match DNS records)
# staging.<DOMAIN> and api-staging.<DOMAIN>

# ============================================
# Staging Access Protection (Traefik Basic Auth)
# ============================================
# Generate Basic Auth credentials using htpasswd:
#   htpasswd -nbB <USERNAME> <PASSWORD>
# Example output: admin:$2y$10$abc123...
# Set the full output (username:hash) here:
STAGING_BASIC_AUTH_USERS=admin:$2y$10$change_me_generate_with_htpasswd

# Optional: IP Allowlist (comma-separated CIDR ranges)
# Only allow access from these IPs (in addition to Basic Auth)
# Example: "1.2.3.4/32,5.6.7.0/24"
# Leave empty to allow all IPs (Basic Auth only)
STAGING_ALLOW_IPS=

# ============================================
# PostgreSQL Database (Staging - Separate from Production)
# ============================================
POSTGRES_DB_STAGING=exam_platform_staging
POSTGRES_USER_STAGING=exam_user_staging
POSTGRES_PASSWORD_STAGING=change_me_staging_secret
POSTGRES_HOST_STAGING=postgres_staging
POSTGRES_PORT=5432

# Database connection string (SQLAlchemy format)
DATABASE_URL=postgresql+psycopg2://exam_user_staging:change_me_staging_secret@postgres_staging:5432/exam_platform_staging

# ============================================
# Backend (FastAPI) - Staging
# ============================================
# JWT Authentication (MUST be different from production)
JWT_SECRET_STAGING=change_me_staging_jwt_secret
JWT_ACCESS_TTL_MIN=15
JWT_REFRESH_TTL_DAYS=14

# Token hashing pepper (MUST be different from production)
AUTH_TOKEN_PEPPER_STAGING=change_me_staging_token_pepper
TOKEN_PEPPER_STAGING=change_me_staging_token_pepper

# MFA (Multi-Factor Authentication) - Staging
# Fernet encryption key for encrypting TOTP secrets (MUST be different from production)
# Generate with: docker run --rm python:3.11-slim sh -c "pip install cryptography --quiet && python -c 'from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())'"
# REQUIRED for staging
MFA_ENCRYPTION_KEY_STAGING=KYT4-bdF9FH1aMAfo0zrQsg4BqKqqsu9Zckh1nNoHBI=

# CORS Configuration (staging domains)
CORS_ALLOW_ORIGINS_PUBLIC_STAGING=https://staging.example.com
CORS_ALLOW_ORIGINS_APP_STAGING=https://staging.example.com
CORS_ALLOW_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOW_HEADERS=Authorization,Content-Type,X-Request-ID
CORS_EXPOSE_HEADERS=X-Request-ID,X-Response-Time-ms,X-DB-Queries,X-DB-Time-ms
CORS_ALLOW_CREDENTIALS=true

# ============================================
# Redis (Staging - Separate from Production)
# ============================================
REDIS_URL=redis://redis_staging:6379/0
REDIS_PORT=6379

# ============================================
# Neo4j Graph Database (Shared or Separate)
# ============================================
# Staging can share Neo4j with production (read-only) or use separate instance
NEO4J_ENABLED=false
NEO4J_URI=bolt://neo4j:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=change_me
NEO4J_DATABASE=neo4j

# ============================================
# Elasticsearch (Staging - Separate Index Prefix)
# ============================================
ELASTICSEARCH_ENABLED=false
ELASTICSEARCH_URL=http://elasticsearch:9200
ELASTICSEARCH_INDEX_PREFIX_STAGING=platform_staging
ELASTICSEARCH_REQUEST_TIMEOUT_MS=2000
ELASTICSEARCH_BULK_BATCH_SIZE=500
ELASTICSEARCH_RETRY_MAX=5

# ============================================
# Frontend (Next.js) - Staging
# ============================================
NEXT_PUBLIC_API_BASE_URL=https://api-staging.example.com/v1
NEXT_PUBLIC_APP_NAME=Exam Prep Platform (Staging)
NEXT_PUBLIC_ENV=staging
NEXT_PUBLIC_APP_BASE_URL=https://staging.example.com

# ============================================
# OAuth Configuration (Staging)
# ============================================
# Use staging OAuth apps/credentials (different from production)
OAUTH_GOOGLE_CLIENT_ID_STAGING=
OAUTH_GOOGLE_CLIENT_SECRET_STAGING=
OAUTH_MICROSOFT_CLIENT_ID_STAGING=
OAUTH_MICROSOFT_CLIENT_SECRET_STAGING=
OAUTH_MICROSOFT_TENANT=common

# ============================================
# Email Configuration (Staging - Safe Defaults)
# ============================================
# Staging should use shadow mode or disabled to prevent accidental emails
EMAIL_BACKEND_STAGING=shadow
EMAIL_HOST=
EMAIL_PORT=587
EMAIL_USER=
EMAIL_PASSWORD=
EMAIL_FROM_STAGING=noreply-staging@example.com
EMAIL_USE_TLS=true
EMAIL_USE_SSL=false

# ============================================
# Security Headers
# ============================================
ENABLE_HSTS=false  # Traefik handles HSTS at edge
ENABLE_CSP=false

# ============================================
# Logging
# ============================================
LOG_LEVEL=INFO

# ============================================
# Feature Flags (Staging)
# ============================================
# Disable analytics, external integrations in staging
GO_RANKING_ENABLED=false
RANKING_GO_URL=http://ranking-go:8080

# ============================================
# Notes
# ============================================
# - ALL secrets MUST be different from production
# - Staging uses separate database (postgres_staging)
# - Staging uses separate Redis (redis_staging)
# - Email should be in shadow mode or disabled
# - CORS origins must match staging domains
# - OAuth redirect URIs must use staging domains
