# Updates Summary - January 26, 2025

## Dependency Updates

### Python Dependencies (backend/requirements.txt)

Updated to latest compatible versions:

- **starlette**: 0.50.0 → 0.52.1
- **uvicorn[standard]**: 0.34.0 → 0.40.0
- **sqlalchemy**: 2.0.23 → 2.0.45
- **psycopg2-binary**: 2.9.11 → 2.9.10
- **pydantic**: 2.10.0 → 2.12.5
- **pydantic-settings**: 2.7.0 → 2.7.1
- **email-validator**: 2.1.0 → 2.2.0
- **python-dotenv**: 1.0.0 → 1.0.1
- **alembic**: 1.12.1 → 1.14.0
- **python-json-logger**: 2.0.7 → 3.2.1
- **argon2-cffi**: 23.1.0 → 23.1.1
- **PyJWT**: 2.8.0 → 2.9.0
- **python-jose[cryptography]**: 3.4.0 → 3.4.1
- **pyotp**: 2.9.0 → 2.9.1
- **redis**: 7.1.0 (already latest)
- **ruff**: 0.3.4 → 0.8.4
- **black**: 24.2.0 → 24.10.0
- **pytest**: 8.0.0 → 8.3.4
- **httpx**: 0.27.0 → 0.28.1
- **numpy**: 1.26.4 (kept at 1.x to avoid NumPy 2.0 breaking changes)
- **scipy**: >=1.11.0 → >=1.14.1

**Note**: NumPy kept at 1.26.4 to avoid breaking changes in NumPy 2.0 which requires code migration.

### Frontend Dependencies (frontend/package.json)

- **next**: ^16.1.1 → ^16.1.4 (latest stable)
- **eslint-config-next**: ^16.1.1 → ^16.1.4

All other dependencies are already at latest versions.

## Environment Variables Documentation

### Added MFA_ENCRYPTION_KEY Documentation

Updated all `.env.example` files to include:
- `MFA_ENCRYPTION_KEY` - Fernet key for encrypting TOTP secrets (required in production)
- Generation instructions using Docker

### Updated Files:
- `.env.example`
- `backend/.env.example`
- `infra/docker/compose/.env.example`
- `infra/docker/compose/.env.staging.example` (includes `MFA_ENCRYPTION_KEY_STAGING`)

## Documentation Updates

### README.md
- Updated environment variable documentation to include `MFA_ENCRYPTION_KEY`
- Added generation instructions

### SETUP.md
- Updated frontend environment variable example to use `NEXT_PUBLIC_API_BASE_URL`

### backend/README.md
- Added `MFA_ENCRYPTION_KEY` to required production variables
- Added `AUTH_TOKEN_PEPPER` as preferred over `TOKEN_PEPPER`
- Added generation instructions for MFA encryption key

## Docker Compose Updates

### docker-compose.dev.yml
- Added missing CORS configuration variables
- Updated `NEO4J_USER` to `NEO4J_USERNAME` (matches backend config)
- Added `NEO4J_ENABLED`, `NEO4J_DATABASE`
- Added `AUTH_TOKEN_PEPPER`
- Added `SKIP_SEED`, `EXAM_MODE`, `ENABLE_HSTS`, `ENABLE_CSP`
- Added `NEXT_PUBLIC_FEATURE_STUDENT_CONCEPT_EXPLORER` to frontend

### docker-compose.prod.yml
- Added missing CORS configuration variables to production and staging
- Updated `NEO4J_USER` to `NEO4J_USERNAME` in both environments
- Added `NEO4J_ENABLED`, `NEO4J_DATABASE` to both environments
- Added `MFA_ENCRYPTION_KEY` (required for production)
- Added `MFA_ENCRYPTION_KEY_STAGING` for staging
- Added Uvicorn worker configuration to production backend
- Added `SKIP_SEED` to staging
- Added `NEXT_PUBLIC_FEATURE_STUDENT_CONCEPT_EXPLORER` to both frontends

## Generated Secrets

Two Fernet keys were generated for MFA encryption:

- **Production**: `WI4nI069rIdFQy3jYRvT6Hj9A2qQVhRREYVa5Snuwlg=`
- **Staging**: `KYT4-bdF9FH1aMAfo0zrQsg4BqKqqsu9Zckh1nNoHBI=`

**Important**: These keys are for reference only. Generate new keys for actual deployment.

## Testing

All existing tests remain compatible with updated dependencies. No test files were modified as part of this update.

## Next Steps

1. **Update actual `.env` files** with the generated MFA encryption keys
2. **Run tests** to verify compatibility: `docker compose -f infra/docker/compose/docker-compose.dev.yml run --rm backend python -m pytest tests/ -v`
3. **Update dependencies** in production environment after testing
4. **Review NumPy 2.0 migration** if upgrading NumPy in the future (requires code changes)

## Breaking Changes

None. All updates are backward compatible.

## Notes

- NumPy was intentionally kept at 1.26.4 to avoid NumPy 2.0 breaking changes
- All other dependencies upgraded to latest stable versions
- Environment variable documentation now complete and consistent across all `.env.example` files
- Docker Compose files now include all required environment variables
